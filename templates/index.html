<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performative Male Evaluator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'shimmer': 'shimmer 3s linear infinite',
                        'gradient': 'gradient 8s ease infinite',
                        'bounce-slow': 'bounce 2s infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        shimmer: {
                            '0%': { transform: 'translateX(-100%) translateY(-100%) rotate(45deg)' },
                            '100%': { transform: 'translateX(100%) translateY(100%) rotate(45deg)' },
                        },
                        gradient: {
                            '0%, 100%': { backgroundPosition: '0% 50%' },
                            '50%': { backgroundPosition: '100% 50%' },
                        },
                    },
                    backgroundSize: {
                        '200%': '200% 200%',
                    },
                },
            },
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            background-size: 200% 200%;
            animation: gradient 8s ease infinite;
        }
        
        .score-circle-gradient {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%);
            background-size: 200% 200%;
            animation: gradient 4s ease infinite;
        }
        
        .upload-area-gradient {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }
        
        .roast-gradient {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 50%, #fca5a5 100%);
            animation: pulse-slow 2s ease-in-out infinite;
        }
        
        .suggestions-gradient {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        }
        
        .shimmer-effect::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s linear infinite;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 bg-fixed">
    <div class="min-h-screen flex items-center justify-center p-4 md:p-8">
        <div class="w-full max-w-4xl">
            <!-- Main Card -->
            <div class="bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 p-6 md:p-10 lg:p-12 animate-fade-in">
                <!-- Header -->
                <div class="text-center mb-8 space-y-3">
                    <h1 class="text-4xl md:text-5xl lg:text-6xl font-black gradient-text">
                        üé≠ Performative Male Evaluator
                    </h1>
                    <p class="text-gray-600 text-lg md:text-xl font-medium">
                        Upload an image or take a photo to analyze performativeness percentage
                    </p>
                </div>

                <!-- Mode Toggle -->
                <div class="flex gap-3 justify-center mb-8">
                    <button id="uploadModeBtn" class="px-6 py-3 rounded-xl font-semibold text-sm md:text-base transition-all duration-300 bg-gradient-to-r from-indigo-500 to-purple-500 text-white shadow-lg hover:shadow-xl hover:scale-105 active:scale-95">
                        üìÅ Upload Image
                    </button>
                    <button id="cameraModeBtn" class="px-6 py-3 rounded-xl font-semibold text-sm md:text-base transition-all duration-300 bg-white border-2 border-gray-200 text-gray-700 hover:border-indigo-300 hover:bg-gray-50 hover:scale-105 active:scale-95">
                        üì∑ Take Photo
                    </button>
                </div>

                <!-- Upload Area -->
                <div id="uploadArea" class="upload-area-gradient border-3 border-dashed border-indigo-300 rounded-2xl p-12 md:p-16 text-center cursor-pointer transition-all duration-300 hover:border-indigo-400 hover:shadow-lg hover:scale-[1.02] active:scale-[0.98] relative overflow-hidden group">
                    <div class="relative z-10">
                        <div class="text-6xl md:text-7xl mb-4 filter drop-shadow-lg transform group-hover:scale-110 transition-transform duration-300">üì∏</div>
                        <div class="text-indigo-600 text-xl md:text-2xl font-bold mb-2">Click or drag image here</div>
                        <div class="text-gray-500 text-sm md:text-base">Supports JPG, PNG, and other image formats</div>
                    </div>
                    <input type="file" id="imageInput" accept="image/*" class="hidden">
                </div>

                <!-- Camera Container -->
                <div id="cameraContainer" class="hidden text-center mb-6 space-y-4">
                    <video id="cameraPreview" class="w-full max-w-full max-h-[450px] rounded-2xl shadow-2xl border-4 border-white object-cover bg-black" autoplay playsinline muted></video>
                    <canvas id="cameraCanvas" class="hidden"></canvas>
                    <div class="flex gap-3 justify-center flex-wrap">
                        <button id="captureBtn" class="px-6 py-3 rounded-xl font-semibold bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-lg hover:shadow-xl hover:scale-105 active:scale-95 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100" disabled>
                            üì∏ Capture Photo
                        </button>
                        <button id="stopCameraBtn" class="px-6 py-3 rounded-xl font-semibold bg-gradient-to-r from-red-500 to-rose-500 text-white shadow-lg hover:shadow-xl hover:scale-105 active:scale-95 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100" disabled>
                            Stop Camera
                        </button>
                    </div>
                    <div id="cameraError" class="text-red-500 text-sm font-medium"></div>
                </div>

                <!-- Preview Container -->
                <div id="previewContainer" class="hidden text-center space-y-6 mb-6 animate-slide-up">
                    <img id="previewImage" class="w-full max-w-full max-h-[450px] rounded-2xl shadow-2xl border-4 border-white object-contain mx-auto" alt="Preview">
                    <button id="analyzeBtn" class="px-8 py-4 rounded-xl font-bold text-lg bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-white shadow-xl hover:shadow-2xl hover:scale-105 active:scale-95 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 bg-[length:200%_200%] animate-gradient">
                        Analyze Image
                    </button>
                </div>

                <!-- Loading -->
                <div id="loading" class="hidden text-center py-12 space-y-4">
                    <div class="inline-block w-16 h-16 border-4 border-gray-200 border-t-indigo-500 rounded-full animate-spin"></div>
                    <p class="text-gray-600 font-medium text-lg">Analyzing image with Gemini Vision AI...</p>
                </div>

                <!-- Error -->
                <div id="error" class="hidden bg-gradient-to-r from-red-50 to-rose-50 border-2 border-red-200 text-red-700 px-6 py-4 rounded-xl font-semibold mb-6 animate-slide-up"></div>

                <!-- Results -->
                <div id="results" class="hidden space-y-6 animate-slide-up">
                    <!-- Score Circle -->
                    <div class="text-center">
                        <div class="score-circle-gradient w-48 h-48 md:w-56 md:h-56 lg:w-64 lg:h-64 rounded-full flex items-center justify-center mx-auto shadow-2xl relative">
                            <div class="absolute inset-0 rounded-full bg-white/10 backdrop-blur-sm"></div>
                            <div class="relative z-10 text-center">
                                <div id="scorePercentage" class="text-5xl md:text-6xl lg:text-7xl font-black text-white mb-2">0%</div>
                                <div class="text-white/90 text-sm md:text-base font-semibold uppercase tracking-wider">Performativeness Score</div>
                            </div>
                        </div>
                    </div>

                    <!-- Detected Items Card -->
                    <div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl p-6 md:p-8 border border-gray-200 shadow-lg">
                        <h3 class="text-2xl md:text-3xl font-bold text-gray-900 mb-4">Detected Characteristics</h3>
                        <div id="categoryBadges" class="flex flex-wrap gap-2 mb-6"></div>
                        
                        <h3 class="text-2xl md:text-3xl font-bold text-gray-900 mb-4 mt-6">Detected Items</h3>
                        <ul id="itemList" class="space-y-3"></ul>
                    </div>

                    <!-- Roast Section -->
                    <div id="roastSection" class="rounded-2xl p-6 md:p-8 border-4 shadow-2xl relative overflow-hidden hidden">
                        <div class="shimmer-effect absolute inset-0"></div>
                        <div class="relative z-10">
                            <h3 id="roastTitle" class="text-2xl md:text-3xl font-black mb-4 uppercase tracking-tight">üíÄ THE VERDICT üíÄ</h3>
                            <p id="roastText" class="text-lg md:text-xl font-bold leading-relaxed"></p>
                        </div>
                    </div>

                    <!-- Improvement Suggestions -->
                    <div id="improvementSection" class="suggestions-gradient rounded-2xl p-6 md:p-8 border-2 border-amber-300 shadow-lg hidden">
                        <h3 class="text-2xl md:text-3xl font-bold text-amber-900 mb-3">üöÄ How to Reach 100%</h3>
                        <p id="improvementIntro" class="text-amber-800 mb-6 italic font-medium">Here's how you can improve your performativeness score:</p>
                        <ul id="improvementList" class="space-y-3"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const imageInput = document.getElementById('imageInput');
        const previewContainer = document.getElementById('previewContainer');
        const previewImage = document.getElementById('previewImage');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const loading = document.getElementById('loading');
        const results = document.getElementById('results');
        const error = document.getElementById('error');
        const scorePercentage = document.getElementById('scorePercentage');
        const categoryBadges = document.getElementById('categoryBadges');
        const itemList = document.getElementById('itemList');
        const improvementSection = document.getElementById('improvementSection');
        const improvementList = document.getElementById('improvementList');
        const roastSection = document.getElementById('roastSection');
        const roastText = document.getElementById('roastText');
        const roastTitle = document.getElementById('roastTitle');
        
        // Camera elements
        const uploadModeBtn = document.getElementById('uploadModeBtn');
        const cameraModeBtn = document.getElementById('cameraModeBtn');
        const cameraContainer = document.getElementById('cameraContainer');
        const cameraPreview = document.getElementById('cameraPreview');
        const cameraCanvas = document.getElementById('cameraCanvas');
        const captureBtn = document.getElementById('captureBtn');
        const stopCameraBtn = document.getElementById('stopCameraBtn');
        const cameraError = document.getElementById('cameraError');

        let currentImageData = null;
        let currentStream = null;
        let currentMode = 'upload';

        // Mode toggle
        uploadModeBtn.addEventListener('click', () => switchMode('upload'));
        cameraModeBtn.addEventListener('click', () => switchMode('camera'));

        function switchMode(mode) {
            currentMode = mode;
            
            if (mode === 'upload') {
                uploadModeBtn.className = 'px-6 py-3 rounded-xl font-semibold text-sm md:text-base transition-all duration-300 bg-gradient-to-r from-indigo-500 to-purple-500 text-white shadow-lg hover:shadow-xl hover:scale-105 active:scale-95';
                cameraModeBtn.className = 'px-6 py-3 rounded-xl font-semibold text-sm md:text-base transition-all duration-300 bg-white border-2 border-gray-200 text-gray-700 hover:border-indigo-300 hover:bg-gray-50 hover:scale-105 active:scale-95';
                uploadArea.classList.remove('hidden');
                cameraContainer.classList.add('hidden');
                stopCamera();
            } else {
                cameraModeBtn.className = 'px-6 py-3 rounded-xl font-semibold text-sm md:text-base transition-all duration-300 bg-gradient-to-r from-indigo-500 to-purple-500 text-white shadow-lg hover:shadow-xl hover:scale-105 active:scale-95';
                uploadModeBtn.className = 'px-6 py-3 rounded-xl font-semibold text-sm md:text-base transition-all duration-300 bg-white border-2 border-gray-200 text-gray-700 hover:border-indigo-300 hover:bg-gray-50 hover:scale-105 active:scale-95';
                uploadArea.classList.add('hidden');
                cameraContainer.classList.remove('hidden');
                
                setTimeout(() => {
                    const rect = cameraContainer.getBoundingClientRect();
                    if (rect.width > 0 && rect.height > 0) {
                        startCamera();
                    } else {
                        cameraError.textContent = 'Camera container is not visible. Please refresh the page.';
                    }
                }, 300);
            }
            
            previewContainer.classList.add('hidden');
            results.classList.add('hidden');
            error.classList.add('hidden');
            currentImageData = null;
        }

        async function startCamera() {
            cameraError.textContent = '';
            captureBtn.disabled = true;
            stopCameraBtn.disabled = true;
            
            if (currentStream) {
                stopCamera();
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            const isSecureContext = window.isSecureContext || location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1';
            
            if (!isSecureContext) {
                cameraError.textContent = 'Camera access requires HTTPS or localhost. Please use HTTPS or run on localhost.';
                return;
            }
            
            try {
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('Camera API not available. Your browser may not support camera access.');
                }
                
                let stream;
                try {
                    stream = await navigator.mediaDevices.getUserMedia({ video: true });
                } catch (simpleErr) {
                    try {
                        stream = await navigator.mediaDevices.getUserMedia({
                            video: { facingMode: 'user' }
                        });
                    } catch (frontErr) {
                        throw simpleErr;
                    }
                }
                
                if (!stream) {
                    throw new Error('Failed to obtain camera stream');
                }
                
                currentStream = stream;
                cameraPreview.srcObject = stream;
                
                if (cameraPreview.readyState >= 2) {
                    await cameraPreview.play();
                    captureBtn.disabled = false;
                    stopCameraBtn.disabled = false;
                    cameraError.textContent = '';
                } else {
                    cameraPreview.onloadedmetadata = async () => {
                        await cameraPreview.play();
                        captureBtn.disabled = false;
                        stopCameraBtn.disabled = false;
                        cameraError.textContent = '';
                    };
                    cameraPreview.play().then(() => {
                        captureBtn.disabled = false;
                        stopCameraBtn.disabled = false;
                        cameraError.textContent = '';
                    }).catch(() => {});
                }
                
                stream.getVideoTracks().forEach(track => {
                    track.addEventListener('ended', () => {
                        stopCamera();
                        cameraError.textContent = 'Camera stream ended. Click "Take Photo" again to restart.';
                    });
                });
                
            } catch (err) {
                let errorMessage = 'Unable to access camera. ';
                
                if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
                    errorMessage = 'Camera permission denied. Please allow camera access in your browser settings and try again.';
                } else if (err.name === 'NotFoundError' || err.name === 'DevicesNotFoundError') {
                    errorMessage = 'No camera found on your device. Please use the upload option instead.';
                } else if (err.name === 'NotReadableError' || err.name === 'TrackStartError') {
                    errorMessage = 'Camera is being used by another application. Please close other apps using the camera and try again.';
                } else if (err.name === 'OverconstrainedError') {
                    errorMessage = 'Camera constraints not supported by your device.';
                } else if (err.name === 'SecurityError') {
                    errorMessage = 'Camera access blocked due to security restrictions. Please use HTTPS or localhost.';
                } else {
                    errorMessage += err.message || 'Unknown error.';
                }
                
                cameraError.textContent = errorMessage;
                captureBtn.disabled = true;
                stopCameraBtn.disabled = true;
                showError(errorMessage);
            }
        }

        function stopCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
            }
            if (cameraPreview) {
                cameraPreview.srcObject = null;
                cameraPreview.onloadedmetadata = null;
            }
            captureBtn.disabled = true;
            stopCameraBtn.disabled = true;
        }

        stopCameraBtn.addEventListener('click', stopCamera);

        captureBtn.addEventListener('click', () => {
            if (!currentStream) return;
            
            cameraCanvas.width = cameraPreview.videoWidth;
            cameraCanvas.height = cameraPreview.videoHeight;
            
            const ctx = cameraCanvas.getContext('2d');
            ctx.drawImage(cameraPreview, 0, 0);
            
            const imageData = cameraCanvas.toDataURL('image/jpeg', 0.9);
            
            currentImageData = imageData;
            previewImage.src = imageData;
            previewContainer.classList.remove('hidden');
            results.classList.add('hidden');
            error.classList.add('hidden');
            
            stopCamera();
            
            uploadModeBtn.className = 'px-6 py-3 rounded-xl font-semibold text-sm md:text-base transition-all duration-300 bg-gradient-to-r from-indigo-500 to-purple-500 text-white shadow-lg hover:shadow-xl hover:scale-105 active:scale-95';
            cameraModeBtn.className = 'px-6 py-3 rounded-xl font-semibold text-sm md:text-base transition-all duration-300 bg-white border-2 border-gray-200 text-gray-700 hover:border-indigo-300 hover:bg-gray-50 hover:scale-105 active:scale-95';
            cameraContainer.classList.add('hidden');
            uploadArea.classList.remove('hidden');
            currentMode = 'upload';
        });

        // Upload area click
        uploadArea.addEventListener('click', () => {
            if (currentMode === 'upload') {
                imageInput.click();
            }
        });

        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('border-indigo-500', 'bg-indigo-50');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('border-indigo-500', 'bg-indigo-50');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-indigo-500', 'bg-indigo-50');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleImageFile(files[0]);
            }
        });

        // File input change
        imageInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleImageFile(e.target.files[0]);
            }
        });

        function handleImageFile(file) {
            if (!file.type.startsWith('image/')) {
                showError('Please upload an image file');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                currentImageData = e.target.result;
                previewImage.src = currentImageData;
                previewContainer.classList.remove('hidden');
                results.classList.add('hidden');
                error.classList.add('hidden');
            };
            reader.readAsDataURL(file);
        }

        // Analyze button
        analyzeBtn.addEventListener('click', async () => {
            if (!currentImageData) {
                showError('Please upload an image first');
                return;
            }

            loading.classList.remove('hidden');
            results.classList.add('hidden');
            error.classList.add('hidden');
            analyzeBtn.disabled = true;

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        image: currentImageData
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Analysis failed');
                }

                displayResults(data);
            } catch (err) {
                showError(err.message);
            } finally {
                loading.classList.add('hidden');
                analyzeBtn.disabled = false;
            }
        });

        function displayResults(data) {
            scorePercentage.textContent = data.percentage + '%';
            
            // Update score circle color based on percentage
            const scoreCircle = document.querySelector('.score-circle-gradient');
            if (data.percentage >= 70) {
                scoreCircle.className = 'w-48 h-48 md:w-56 md:h-56 lg:w-64 lg:h-64 rounded-full flex items-center justify-center mx-auto shadow-2xl relative bg-gradient-to-r from-pink-500 via-rose-500 to-pink-400 bg-[length:200%_200%] animate-gradient';
            } else if (data.percentage >= 40) {
                scoreCircle.className = 'w-48 h-48 md:w-56 md:h-56 lg:w-64 lg:h-64 rounded-full flex items-center justify-center mx-auto shadow-2xl relative bg-gradient-to-r from-amber-500 via-yellow-400 to-amber-400 bg-[length:200%_200%] animate-gradient';
            } else {
                scoreCircle.className = 'w-48 h-48 md:w-56 md:h-56 lg:w-64 lg:h-64 rounded-full flex items-center justify-center mx-auto shadow-2xl relative bg-gradient-to-r from-emerald-500 via-green-400 to-emerald-400 bg-[length:200%_200%] animate-gradient';
            }

            // Display category badges
            categoryBadges.innerHTML = '';
            if (data.category_details && data.category_details.length > 0) {
                data.category_details.forEach(category => {
                    const badge = document.createElement('span');
                    badge.className = 'inline-block px-4 py-2 rounded-full text-sm font-semibold text-white bg-gradient-to-r from-indigo-500 to-purple-500 shadow-md hover:shadow-lg hover:scale-105 transition-all duration-200';
                    badge.textContent = category.name + ` (+${category.weight}pts)`;
                    categoryBadges.appendChild(badge);
                });
            } else {
                categoryBadges.innerHTML = '<p class="text-gray-500 italic">No characteristics detected</p>';
            }

            // Display detected items
            itemList.innerHTML = '';
            if (data.detected_items && data.detected_items.length > 0) {
                data.detected_items.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'bg-white px-5 py-3 rounded-xl border-l-4 border-indigo-500 shadow-sm hover:shadow-md hover:translate-x-1 transition-all duration-200 text-gray-700 font-medium';
                    li.textContent = item;
                    itemList.appendChild(li);
                });
            } else {
                itemList.innerHTML = '<li class="bg-white px-5 py-3 rounded-xl border-l-4 border-gray-300 shadow-sm text-gray-500 italic">No items detected</li>';
            }

            // Display roast based on percentage
            if (data.roast) {
                roastText.textContent = data.roast;
                roastSection.classList.remove('hidden');
                
                // Style based on percentage range
                if (data.percentage < 30) {
                    // Brutal roast style - red/pink
                    roastSection.className = 'bg-gradient-to-br from-red-100 via-rose-100 to-pink-100 rounded-2xl p-6 md:p-8 border-4 border-red-400 shadow-2xl relative overflow-hidden';
                    roastTitle.className = 'text-2xl md:text-3xl font-black text-red-900 mb-4 uppercase tracking-tight';
                    roastTitle.textContent = 'üíÄ THE VERDICT üíÄ';
                    roastText.className = 'text-red-800 text-lg md:text-xl font-bold leading-relaxed';
                } else if (data.percentage >= 30 && data.percentage < 60) {
                    // Mixed feedback style - orange/amber (roast + compliments)
                    roastSection.className = 'bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50 rounded-2xl p-6 md:p-8 border-4 border-amber-400 shadow-2xl relative overflow-hidden';
                    roastTitle.className = 'text-2xl md:text-3xl font-black text-amber-900 mb-4 uppercase tracking-tight';
                    roastTitle.textContent = 'üí¨ HONEST FEEDBACK üí¨';
                    roastText.className = 'text-amber-900 text-lg md:text-xl font-bold leading-relaxed';
                }
            } else {
                roastSection.classList.add('hidden');
            }

            // Display improvement suggestions
            improvementList.innerHTML = '';
            if (data.percentage >= 100) {
                improvementSection.classList.add('hidden');
            } else if (data.improvement_suggestions && data.improvement_suggestions.length > 0) {
                data.improvement_suggestions.forEach(suggestion => {
                    if (suggestion.length > 15 && !suggestion.toLowerCase().includes('focus on adding these high-value items')) {
                        const li = document.createElement('li');
                        li.className = 'bg-white px-5 py-4 rounded-xl border-l-4 border-amber-500 shadow-sm hover:shadow-md hover:translate-x-1 transition-all duration-200 text-amber-900 font-medium relative pl-12';
                        li.innerHTML = `<span class="absolute left-4 text-xl">üí°</span>${suggestion}`;
                        improvementList.appendChild(li);
                    }
                });
                
                if (improvementList.children.length === 0) {
                    improvementList.innerHTML = '<li class="bg-white px-5 py-4 rounded-xl border-l-4 border-amber-500 shadow-sm text-amber-900 font-medium">Keep adding performative items to reach 100%! Focus on high-value items like feminist literature, tote bags, and matcha lattes.</li>';
                }
                
                improvementSection.classList.remove('hidden');
            } else {
                improvementSection.classList.remove('hidden');
                improvementList.innerHTML = '<li class="bg-white px-5 py-4 rounded-xl border-l-4 border-amber-500 shadow-sm text-amber-900 font-medium">Keep adding performative items to reach 100%! Focus on high-value items like feminist literature, tote bags, and matcha lattes.</li>';
            }

            results.classList.remove('hidden');
        }

        function showError(message) {
            error.textContent = message;
            error.classList.remove('hidden');
        }
    </script>
</body>
</html>
